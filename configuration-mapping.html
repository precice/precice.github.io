<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

  <meta name="description" content="When coupling two participants at a common coupling interface, in general, the two surface meshes do not match. Therefore, preCICE provides data mapping methods to map coupling data from one mesh to the other. On this page, we explain how to configure such data mapping methods.">

<meta name="keywords" content=" configuration, mapping, meshes, coupling">
<meta name="theme-color" content="#0A76BB">
<meta name="msapplication-square310x310logo" content="images/icon-310x310.png">

<title>Mapping configuration | preCICE - The Coupling Library</title>
<link rel="alternate" type="application/rss+xml" title="" href="https://precice.org/feed.xml">

<link rel="shortcut icon" href="images/favicon.ico">
<link rel="stylesheet" href="css/syntax.css">
<link rel="icon" sizes="192x192" href="images/icon.png">
<link rel="apple-touch-icon" sizes="310x310" href="images/icon-310x310.png">

<!-- Font Awesome -->
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">

<!-- Bootstrap -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Local CSS -->
<link rel="stylesheet" href="css/modern-business.css">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/customstyles-precice.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<link rel="stylesheet" href="css/bookcover.css">
<!-- Color styles -->
<link rel="stylesheet" href="css/theme-precice.css">
<!-- Styling for landing page -->


<!-- Jquery, Ajax -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js"></script>

<!-- Anchor.js -->
<script src="https://cdn.jsdelivr.net/npm/anchor-js@4.2.0/anchor.min.js" integrity="sha256-m1eTvwEHwmsw4+XKF7BshClVJEPwTVycveNl0CS0Mkk=" crossorigin="anonymous"></script>

<!-- Bootstrap JavaScript (requires jquery) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Local JS -->
<script src="js/jquery.navgoco.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<!-- To automatically render math in text elements, include the auto-render extension: -->
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

<!-- Algolia search -->
<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<!-- QR code to retrieve printed page -->
<style>
@media print {
    div.post-header:before {
    	content: url('https://chart.googleapis.com/chart?cht=qr&chs=100x100&chl=https://precice.org/configuration-mapping.html&choe=UTF-8');
        margin-top: -25px;
        float: right;
    }
}
</style>

<!-- Plausible Analytics -->
<script async defer data-domain="precice.org" src="https://plausible.io/js/plausible.js"></script>

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    <script>
        // wrap tables into a div to make them scrollable on small viewports
        // https://getbootstrap.com/docs/3.4/css/#tables-responsive
        $(document).ready(function() {
            $('table').addClass('table');
            $('table').wrap('<div class="table-responsive"></div>');
        });
    </script>
    
</head>
<body>
    <header>
        <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">
            <span class="navbar-brand-icon">
            <img class="navbar-brand-text" src="images/preCICE_text_28px.svg" alt="preCICE"></span>
            </a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                
                <!-- entries without drop-downs appear here -->

                
                

                
                
                
                
                
                <li><a href="quickstart.html">Quickstart</a></li>
                
                
                
                
                
                <li class="active"><a href="docs.html">Docs</a></li>
                
                
                
                
                
                <li><a href="tutorials.html">Tutorials</a></li>
                
                
                
                
                
                <li><a href="community.html">Community</a></li>
                
                
                
                
                
                <li><a href="https://precice.discourse.group/c/news" target="_blank" rel="noopener">Blog</a></li>
                
                
                
                
                
                <li><a href="about.html">About</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                

                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <div id="search-input"></div>
                        <div id="search-results"></div>
                        <script>
const algoliaSearch = instantsearch({
  appId: 'I5M4FAJYBH',
  apiKey: 'd6f8d2f113bc342ee3f42421d0153bad',
  indexName: 'jekyll',
  searchFunction: function(helper) {          // hide search result in init query
    var searchResults = $('#search-results');
    if (helper.state.query === '') {
      searchResults.hide();
      return;
    }
    helper.search();
    searchResults.show();
  }
});

const hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `${hit.url}#${hit.anchor}`;

  const title = hit._highlightResult.title.value;

  let breadcrumbs = '';
  if (hit._highlightResult.headings) {
    breadcrumbs = hit._highlightResult.headings.map(match => {
      return `<span class="result-breadcrumb">${match.value}</span>`
    }).join(' > ')
  }

  const content = hit._highlightResult.html.value;

  return `
    <div class="result-item">
    <h2><a class="result-link" href="${url}">${title}</a></h2>
    <a href="${url}" class="result-breadcrumbs">${breadcrumbs}</a>
    <div class="result-snippet">${content}</div>
    </div>
  `;
}

algoliaSearch.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-input',
    placeholder: 'Search ...',
    poweredBy: true, // This is required if you're on the free Community plan
    magnifier: false,
    autofocus: false,
    searchOnEnterKeyPressOnly: false,
    reset: true
  })
);

algoliaSearch.addWidget(
  instantsearch.widgets.hits({
    container: '#search-results',
    templates: {
      item: hitTemplate
    }
  })
);

algoliaSearch.start();

// Patch the style of the search input bar generated by the above script
// The equivalent CSS is below, however, including <style> in <body> is against the W3C commandments
// Chrome and Firefox had baby called scope, but it didn't make it
// https://stackoverflow.com/questions/2830296/using-style-tags-in-the-body-with-other-html
var elem = document.querySelector('.ais-search-box--powered-by');
elem.style.marginTop = '-15px';
elem.style.paddingRight = '5px';

var elem = document.querySelector('.nav li a.ais-search-box--powered-by-link');
elem.style.padding = '0';
elem.style.backgroundColor = 'transparent';
elem.style.display = "inline-block";

var elem = document.querySelector('.ais-search-box--input');
elem.style.paddingLeft = '10px';
elem.style.borderColor = '#0A76BB';

var elem = document.querySelector('.ais-search-box');
elem.style.padding = '.5em';
elem.style.marginBottom = '0px';
elem.style.marginLeft = '10px';
elem.style.marginTop = '0px';
elem.style.width = '20em';
elem.style.fontSize = '0.8em';
elem.style.height = '50px';
elem.style.boxSizing = 'border-box';

/*<style type="text/css">
.ais-search-box--powered-by {
  margin-top: -15px;
  padding-right: 5px;
}
.nav li a.ais-search-box--powered-by-link {
  padding: 0;
  background-color: transparent;
  display: inline-block;
}
.ais-search-box--input {
  padding-left: 10px;
  border-color: #0A76BB;
}
.ais-search-box {
  padding: .5em;
  margin-bottom: 0px;
  margin-left: 10px;
  margin-top: 0px;
  width: 20em;
  font-size: 0.8em;
  box-sizing: border-box;
  height: 50px;
}
</style>*/

// some hacky JS to hide the search results until we move to docsearch (which is a true autocomplete-type search)
document.addEventListener('mouseup', function(e) {
  var results = document.getElementById('search-results');
  if (!results.contains(e.target)) {
    results.style.display = 'none';
  }
});
document.addEventListener('mouseup', function(e) {
  var input = document.getElementById('search-input');
  var results = document.getElementById('search-results');
  if (input.contains(e.target)) {
    results.style.display = 'block';
  }
});

</script>
                    </div>
                    <!--end search-->
                </li>
                <li>
                    <a class="no-icon nav-external" href="https://precice.discourse.group" target="_blank" data-show-count="false" aria-label="Join the discourse community"><i class="fab fa-discourse"></i></a>
                </li>
                <li>
                    <a class="no-icon nav-external" href="https://github.com/precice/precice" target="_blank" data-show-count="false" aria-label="Star precice/precice on GitHub"><i class="fab fa-github"></i></a>
                </li>
                <li>
                    <a class="no-icon nav-external" href="https://twitter.com/preCICE_org" target="_blank" data-show-count="false" aria-label="Follow us on Twitter"><i class="fab fa-twitter"></i></a>
                </li>
                <li>
                    <!-- rel="me" required by Mastodon for verification -->
                    <a rel="me" class="no-icon nav-external" href="https://fosstodon.org/@precice" target="_blank" data-show-count="false" aria-label="Follow us on Mastodon"><i class="fab fa-mastodon"></i></a>
                </li>
                <li>
                    <a class="no-icon nav-external" href="https://www.youtube.com/c/preCICECoupling/" target="_blank" data-show-count="false" aria-label="Subscribe on Youtube"><i class="fab fa-youtube"></i></a>
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

    </header>
    <main>
          <!-- News banner -->
          



        <!-- Page Content -->
        <div class="container">
            <div id="main">
                <!-- Content Row -->
                <div class="row">
                    
                    
                    <!-- Sidebar Column -->
                    <div class="col-md-3" id="tg-sb-sidebar">
                        

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">Docs v3.0.0</li>
  
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Fundamentals" href="#">Fundamentals</a>
    <ul>
      
      
      
      <li><a title="Overview" href="docs.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="Terminology" href="fundamentals-terminology.html">Terminology</a></li>
      
      
      
      
      
      
      <li><a title="Literature guide" href="fundamentals-literature-guide.html">Literature guide</a></li>
      
      
      
      
      
      
      <li><a title="Roadmap" href="fundamentals-roadmap.html">Roadmap</a></li>
      
      
      
      
      
      
      <li><a title="Previous versions" href="fundamentals-previous-versions.html">Previous versions</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Installation" href="#">Installation</a>
    <ul>
      
      
      
      <li><a title="Overview" href="installation-overview.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="System packages" href="installation-packages.html">System packages</a></li>
      
      
      
      
      
      
      <li><a title="Using Spack" href="installation-spack.html">Using Spack</a></li>
      
      
      
      <li class="subfolders">
        <a title="Building from source" href="#">Building from source</a>
        <ul>
          
          
          
          <li><a title="Preparation" href="installation-source-preparation.html">Preparation</a></li>
          
          
          
          
          
          <li><a title="Dependencies" href="installation-source-dependencies.html">Dependencies</a></li>
          
          
          
          
          
          <li><a title="Configuration" href="installation-source-configuration.html">Configuration</a></li>
          
          
          
          
          
          <li><a title="Building" href="installation-source-building.html">Building</a></li>
          
          
          
          
          
          <li><a title="Testing" href="installation-source-testing.html">Testing</a></li>
          
          
          
          
          
          <li><a title="Installation" href="installation-source-installation.html">Installation</a></li>
          
          
          
          
          
          <li><a title="Finding" href="installation-source-finding.html">Finding</a></li>
          
          
          
          
          
          <li><a title="Advanced" href="installation-source-advanced.html">Advanced</a></li>
          
          
          
          
          
          <li><a title="Troubleshooting" href="installation-source-troubleshooting.html">Troubleshooting</a></li>
          
          
          
          
          
          <li><a title="Notes on CMake" href="installation-source-cmake.html">Notes on CMake</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      
      
      
      <li><a title="Linking to preCICE" href="installation-linking.html">Linking to preCICE</a></li>
      
      
      
      <li class="subfolders">
        <a title="Language bindings" href="#">Language bindings</a>
        <ul>
          
          
          
          <li><a title="Fortran" href="installation-bindings-fortran.html">Fortran</a></li>
          
          
          
          
          
          <li><a title="Python" href="installation-bindings-python.html">Python</a></li>
          
          
          
          
          
          <li><a title="Matlab" href="installation-bindings-matlab.html">Matlab</a></li>
          
          
          
          
          
          <li><a title="Julia" href="installation-bindings-julia.html">Julia</a></li>
          
          
          
          
          
          <li><a title="Rust" href="installation-bindings-rust.html">Rust</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      
      
      
      <li><a title="Special systems" href="installation-special-systems.html">Special systems</a></li>
      
      
      
      
      
      
      <li><a title="Demo Virtual Machine" href="installation-vm.html">Demo Virtual Machine</a></li>
      
      
      
      
      
      
      <li><a title="preCICE distribution" href="installation-distribution.html">preCICE distribution</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Configuration" href="#">Configuration</a>
    <ul>
      
      
      
      <li><a title="Overview" href="configuration-overview.html">Overview</a></li>
      
      
      
      <li class="subfolders">
        <a title="Basics" href="#">Basics</a>
        <ul>
          
          
          
          <li><a title="Introduction" href="configuration-introduction.html">Introduction</a></li>
          
          
          
          
          
          <li class="active"><a title="Mapping" href="configuration-mapping.html">Mapping</a></li>
          
          
          
          
          
          <li><a title="Communication" href="configuration-communication.html">Communication</a></li>
          
          
          
          
          
          <li><a title="Coupling scheme" href="configuration-coupling.html">Coupling scheme</a></li>
          
          
          
          
          
          <li><a title="Acceleration" href="configuration-acceleration.html">Acceleration</a></li>
          
          
          
          
          
          <li><a title="Mesh exchange example" href="configuration-coupling-mesh-exchange.html">Mesh exchange example</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      <li class="subfolders">
        <a title="Advanced topics" href="#">Advanced topics</a>
        <ul>
          
          
          
          <li><a title="Multi coupling" href="configuration-coupling-multi.html">Multi coupling</a></li>
          
          
          
          
          
          <li><a title="Logging" href="configuration-logging.html">Logging</a></li>
          
          
          
          
          
          <li><a title="Export" href="configuration-export.html">Export</a></li>
          
          
          
          
          
          <li><a title="Action" href="configuration-action.html">Action</a></li>
          
          
          
          
          
          <li><a title="Watchpoint" href="configuration-watchpoint.html">Watchpoint</a></li>
          
          
          
          
          
          <li><a title="Watch integral" href="configuration-watchintegral.html">Watch integral</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      
      
      
      <li><a title="XML reference" href="configuration-xml-reference.html">XML reference</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Tooling" href="#">Tooling</a>
    <ul>
      
      
      
      <li><a title="Overview" href="tooling-overview.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="Artificial solver testing environment (ASTE)" href="tooling-aste.html">Artificial solver testing environment (ASTE)</a></li>
      
      
      
      
      
      
      <li><a title="Built-in tooling" href="tooling-builtin.html">Built-in tooling</a></li>
      
      
      
      
      
      
      <li><a title="Config visualization" href="tooling-config-visualization.html">Config visualization</a></li>
      
      
      
      
      
      
      <li><a title="FMI runner" href="tooling-fmi-runner.html">FMI runner</a></li>
      
      
      
      <li class="subfolders">
        <a title="Micro Manager" href="#">Micro Manager</a>
        <ul>
          
          
          
          <li><a title="Overview" href="tooling-micro-manager-overview.html">Overview</a></li>
          
          
          
          
          
          <li><a title="Get the Micro Manager" href="tooling-micro-manager-installation.html">Get the Micro Manager</a></li>
          
          
          
          
          
          <li><a title="Preparing micro simulation" href="tooling-micro-manager-prepare-micro-simulation.html">Preparing micro simulation</a></li>
          
          
          
          
          
          <li><a title="Configuration" href="tooling-micro-manager-configuration.html">Configuration</a></li>
          
          
          
          
          
          <li><a title="Running" href="tooling-micro-manager-running.html">Running</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      
      
      
      <li><a title="Performance analysis" href="tooling-performance-analysis.html">Performance analysis</a></li>
      
      
      
      
      
      
      <li><a title="RBF shape calculator" href="tooling-rbf-shape.html">RBF shape calculator</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Provided adapters" href="#">Provided adapters</a>
    <ul>
      
      
      
      <li><a title="Overview" href="adapters-overview.html">Overview</a></li>
      
      
      
      <li class="subfolders">
        <a title="OpenFOAM" href="#">OpenFOAM</a>
        <ul>
          
          
          
          <li><a title="Overview" href="adapter-openfoam-overview.html">Overview</a></li>
          
          
          
          
          
          <li><a title="Get the adapter" href="adapter-openfoam-get.html">Get the adapter</a></li>
          
          
          
          
          
          <li><a title="Configuration" href="adapter-openfoam-config.html">Configuration</a></li>
          
          
          
          
          
          <li><a title="Extending" href="adapter-openfoam-extend.html">Extending</a></li>
          
          
          
          
          
          <li><a title="OpenFOAM support" href="adapter-openfoam-support.html">OpenFOAM support</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      <li class="subfolders">
        <a title="deal.II" href="#">deal.II</a>
        <ul>
          
          
          
          <li><a title="Overview" href="adapter-dealii-overview.html">Overview</a></li>
          
          
          
          
          
          <li><a title="Get the adapter" href="adapter-dealii-get.html">Get the adapter</a></li>
          
          
          
          
          
          <li><a title="Configuration" href="adapter-dealii-configure.html">Configuration</a></li>
          
          
          
          
          
          <li><a title="For your own deal.II code" href="adapter-dealii-own-project.html">For your own deal.II code</a></li>
          
          
          
          
          
          <li><a title="Limitations and assumptions" href="adapter-dealii-limitations.html">Limitations and assumptions</a></li>
          
          
          
          
          
          <li><a title="Solver details" href="adapter-dealii-solver-details.html">Solver details</a></li>
          
          
          
          
          
          <li><a title="Coupling Meshes in deal.II" href="adapter-dealii-coupling-meshes.html">Coupling Meshes in deal.II</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      <li class="subfolders">
        <a title="CalculiX" href="#">CalculiX</a>
        <ul>
          
          
          
          <li><a title="Overview" href="adapter-calculix-overview.html">Overview</a></li>
          
          
          
          
          
          <li><a title="Get CalculiX" href="adapter-calculix-get-calculix.html">Get CalculiX</a></li>
          
          
          
          
          
          <li><a title="Get the adapter" href="adapter-calculix-get-adapter.html">Get the adapter</a></li>
          
          
          
          
          
          <li><a title="Build the adapter with PaStiX" href="adapter-calculix-pastix-build.html">Build the adapter with PaStiX</a></li>
          
          
          
          
          
          <li><a title="Configuration" href="adapter-calculix-config.html">Configuration</a></li>
          
          
          
          
          
          <li><a title="Troubleshooting" href="adapter-calculix-troubleshooting.html">Troubleshooting</a></li>
          
          
          
          
          
          <li><a title="Building on SuperMUC" href="adapter-calculix-supermuc.html">Building on SuperMUC</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      <li class="subfolders">
        <a title="SU2" href="#">SU2</a>
        <ul>
          
          
          
          <li><a title="Overview" href="adapter-su2-overview.html">Overview</a></li>
          
          
          
          
          
          <li><a title="Get the adapter" href="adapter-su2-get.html">Get the adapter</a></li>
          
          
          
          
          
          <li><a title="Configuration" href="adapter-su2-configure.html">Configuration</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      
      
      
      <li><a title="FEniCS" href="adapter-fenics.html">FEniCS</a></li>
      
      
      
      
      
      
      <li><a title="code_aster" href="adapter-code_aster.html">code_aster</a></li>
      
      
      
      
      
      
      <li><a title="Nutils" href="adapter-nutils.html">Nutils</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Couple your code" href="#">Couple your code</a>
    <ul>
      
      
      
      <li><a title="Overview" href="couple-your-code-overview.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="Application programming interface" href="couple-your-code-api.html">Application programming interface</a></li>
      
      
      
      <li class="subfolders">
        <a title="Step by step" href="#">Step by step</a>
        <ul>
          
          
          
          <li><a title="Step 1 – Preparation" href="couple-your-code-preparing-your-solver.html">Step 1 – Preparation</a></li>
          
          
          
          
          
          <li><a title="Step 2 – Steering methods" href="couple-your-code-steering-methods.html">Step 2 – Steering methods</a></li>
          
          
          
          
          
          <li><a title="Step 3 – Mesh and data access" href="couple-your-code-mesh-and-data-access.html">Step 3 – Mesh and data access</a></li>
          
          
          
          
          
          <li><a title="Step 4 – Coupling flow" href="couple-your-code-coupling-flow.html">Step 4 – Coupling flow</a></li>
          
          
          
          
          
          <li><a title="Step 5 – Non-matching time step sizes" href="couple-your-code-time-step-sizes.html">Step 5 – Non-matching time step sizes</a></li>
          
          
          
          
          
          <li><a title="Step 6 – Implicit coupling" href="couple-your-code-implicit-coupling.html">Step 6 – Implicit coupling</a></li>
          
          
          
          
          
          <li><a title="Step 7 – Data initialization" href="couple-your-code-initializing-coupling-data.html">Step 7 – Data initialization</a></li>
          
          
          
          
          
          <li><a title="Step 8 – Mesh connectivity" href="couple-your-code-defining-mesh-connectivity.html">Step 8 – Mesh connectivity</a></li>
          
          
          
          
          
          <li><a title="Step 9 – Gradient Data" href="couple-your-code-gradient-data.html">Step 9 – Gradient Data</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      <li class="subfolders">
        <a title="Advanced topics" href="#">Advanced topics</a>
        <ul>
          
          
          
          <li><a title="Adapter software engineering" href="couple-your-code-adapter-software-engineering.html">Adapter software engineering</a></li>
          
          
          
          
          
          <li><a title="Initialization in existing MPI environment" href="couple-your-code-existing-mpi-environment.html">Initialization in existing MPI environment</a></li>
          
          
          
          
          
          <li><a title="Dealing with moving meshes" href="couple-your-code-moving-meshes.html">Dealing with moving meshes</a></li>
          
          
          
          
          
          <li><a title="Dealing with FEM meshes" href="couple-your-code-fem-meshes.html">Dealing with FEM meshes</a></li>
          
          
          
          
          
          <li><a title="Dealing with distributed meshes" href="couple-your-code-distributed-meshes.html">Dealing with distributed meshes</a></li>
          
          
          
          
          
          <li><a title="Direct access to received meshes" href="couple-your-code-direct-access.html">Direct access to received meshes</a></li>
          
          
          
          
          
          <li><a title="Time interpolation of coupling data" href="couple-your-code-waveform.html">Time interpolation of coupling data</a></li>
          
          
          
          
          
          <li><a title="Global data" href="couple-your-code-global-data.html">Global data</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      <li class="subfolders">
        <a title="Porting guides for major versions" href="#">Porting guides for major versions</a>
        <ul>
          
          
          
          <li><a title="Porting adapters in general" href="couple-your-code-porting-overview.html">Porting adapters in general</a></li>
          
          
          
          
          
          <li><a title="Porting from 1.x to 2.x" href="couple-your-code-porting-v1-2.html">Porting from 1.x to 2.x</a></li>
          
          
          
          
          
          <li><a title="Porting from 2.x to 3.x" href="couple-your-code-porting-v2-3.html">Porting from 2.x to 3.x</a></li>
          
          
          
        </ul>
      </li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Running simulations" href="#">Running simulations</a>
    <ul>
      
      
      
      <li><a title="Overview" href="running-overview.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="Running locally" href="running-simple.html">Running locally</a></li>
      
      
      
      
      
      
      <li><a title="Distributed systems" href="running-distributed.html">Distributed systems</a></li>
      
      
      
      
      
      
      <li><a title="SLURM sessions" href="running-slurm.html">SLURM sessions</a></li>
      
      
      
      
      
      
      <li><a title="Output files" href="running-output-files.html">Output files</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Dev docs" href="#">Dev docs</a>
    <ul>
      
      
      
      <li><a title="Overview" href="dev-docs-overview.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="Source documentation" href="dev-docs-sourcedocs.html">Source documentation</a></li>
      
      
      
      
      
      
      <li><a title="General coding conventions" href="dev-docs-dev-conventions.html">General coding conventions</a></li>
      
      
      
      
      
      
      <li><a title="Timings in preCICE" href="dev-docs-dev-eventtimings.html">Timings in preCICE</a></li>
      
      
      
      
      
      
      <li><a title="Logging" href="dev-docs-dev-logging.html">Logging</a></li>
      
      
      
      
      
      
      <li><a title="Optimization" href="dev-docs-dev-optimization.html">Optimization</a></li>
      
      
      
      
      
      
      <li><a title="Release workflow" href="dev-docs-dev-release.html">Release workflow</a></li>
      
      
      
      
      
      
      <li><a title="Running and writing tests" href="dev-docs-dev-testing.html">Running and writing tests</a></li>
      
      
      
      
      
      
      <li><a title="System tests" href="dev-docs-system-tests.html">System tests</a></li>
      
      
      
      
      
      
      <li><a title="Tooling" href="dev-docs-dev-tooling.html">Tooling</a></li>
      
      
      
      
      
      
      <li><a title="Release strategy" href="dev-docs-release-strategy.html">Release strategy</a></li>
      
      
      
      
      
      
      <li><a title="Publication strategy" href="dev-docs-publication-strategy.html">Publication strategy</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  
  <!-- Parent menu item has folderitems -->
  <li>
    <a title="Documentation meta" href="#">Documentation meta</a>
    <ul>
      
      
      
      <li><a title="Overview" href="docs-meta-overview.html">Overview</a></li>
      
      
      
      
      
      
      <li><a title="Migration guide" href="docs-meta-migration-guide.html">Migration guide</a></li>
      
      
      
      
      
      
      <li><a title="Cheatsheet" href="docs-meta-cheatsheet.html">Cheatsheet</a></li>
      
      
      
      
      
      
      <li><a title="Landing page" href="docs-meta-landing-page.html">Landing page</a></li>
      
      
      
      
      
      
      <li><a title="PDF generation" href="docs-meta-publish-to-pdf.html">PDF generation</a></li>
      
      
      
      
      
      
      <li><a title="Common issues" href="docs-meta-common-issues.html">Common issues</a></li>
      
      
      
      
      
      
      <li><a title="Search" href="docs-meta-search.html">Search</a></li>
      
      
      
      
    </ul>
  </li>
  
  
  
  
  <!-- if you aren't using the accordion, uncomment this block:
  <p class="external">
  <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
  </p>
  -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

                    </div>
                    
                    

                    <!-- Content Column -->
                    <div class="col-md-9" id="tg-sb-content">
                        <div class="post-header">
   <h1 class="post-title-main">Mapping configuration</h1>
</div>



<div class="post-content">

    
    <div class="summary">
        <!-- https://github.com/jekyll/jekyll/issues/3571 -->
        When coupling two participants at a common coupling interface, in general, the two surface meshes do not match. Therefore, preCICE provides data mapping methods to map coupling data from one mesh to the other. On this page, we explain how to configure such data mapping methods.

    </div>
    

    <div class="row">
        <div class="col-md-10 col-sm-8">
          
          
          
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

    $('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers:  'h2,h3,h4'  });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

          
          
        </div>

        <div class="col-md-2 col-sm-4">
            
            
                <div class="text-right">
                    <a target="_blank" rel="noopener" href="https://github.com/precice/precice.github.io_future/edit/master/pages/docs/configuration/configuration-mapping.md" class="btn btn-default githubEditButton" role="button"><i class="fab fa-github fa-lg"></i> Edit me</a>
                </div>
            
            
        </div>
    </div>

   <h2 id="basics">Basics</h2>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
The mapping configuration has undergone a major revision between preCICE version 2 and preCICE version 3. For the documentation of version 2, checkout the documentation of <a href="fundamentals-previous-versions.html">our previous versions</a>.
</div>

<p>Each data mapping definition refers to two meshes in the participant configuration: a <code class="language-plaintext highlighter-rouge">provide</code> mesh defined by the participant and a <code class="language-plaintext highlighter-rouge">receive</code> mesh defined by another participant (e.g. <code class="language-plaintext highlighter-rouge">MySolver2</code>):</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;participant</span> <span class="na">name=</span><span class="s">"MySolver1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;provide-mesh</span> <span class="na">name=</span><span class="s">"MyMesh1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;receive-mesh</span> <span class="na">name=</span><span class="s">"MyMesh2"</span> <span class="na">from=</span><span class="s">"MySolver2"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;write-data</span> <span class="na">name=</span><span class="s">"Forces"</span> <span class="na">mesh=</span><span class="s">"MyMesh1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;read-data</span> <span class="na">name=</span><span class="s">"Temperature"</span> <span class="na">mesh=</span><span class="s">"MyMesh1"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mapping:nearest-neighbor</span> <span class="na">direction=</span><span class="s">"read"</span> <span class="na">from=</span><span class="s">"MyMesh2"</span> <span class="na">to=</span><span class="s">"MyMesh1"</span> <span class="na">constraint=</span><span class="s">"consistent"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;mapping:nearest-neighbor</span> <span class="na">direction=</span><span class="s">"write"</span> <span class="na">from=</span><span class="s">"MyMesh1"</span> <span class="na">to=</span><span class="s">"MyMesh2"</span> <span class="na">constraint=</span><span class="s">"conservative"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/participant&gt;</span>
</code></pre></div></div>

<p><img src="images/docs/configuration/doc-mapping.png" alt="Mapping configuration" /></p>

<p>The <code class="language-plaintext highlighter-rouge">provide</code> mesh and <code class="language-plaintext highlighter-rouge">receive</code> mesh are then assigned to the <code class="language-plaintext highlighter-rouge">from</code> and <code class="language-plaintext highlighter-rouge">to</code> slot in the mapping configuration to indicate the mesh, on which data is written, and the mesh, on which data is read. In addition to a <code class="language-plaintext highlighter-rouge">from</code> and <code class="language-plaintext highlighter-rouge">to</code> mesh, each mapping defines a <code class="language-plaintext highlighter-rouge">direction</code>, which can either be <code class="language-plaintext highlighter-rouge">read</code> or <code class="language-plaintext highlighter-rouge">write</code>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">read</code> mappings are executed <em>before</em> you can read data from the mesh. In the example above, <code class="language-plaintext highlighter-rouge">Temperature</code> is received on <code class="language-plaintext highlighter-rouge">MyMesh2</code>, then it is mapped from <code class="language-plaintext highlighter-rouge">MyMesh2</code> to <code class="language-plaintext highlighter-rouge">MyMesh1</code> and, finally, read from <code class="language-plaintext highlighter-rouge">MyMesh1</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">write</code> mappings are executed <em>after</em> you have written data.</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">direction</code> indicates, how the defined meshes are used from the participant perspective: for a <code class="language-plaintext highlighter-rouge">read</code> mapping, the participant reads data from the <code class="language-plaintext highlighter-rouge">provide</code> mesh (<code class="language-plaintext highlighter-rouge">MyMesh1</code>), for a <code class="language-plaintext highlighter-rouge">write</code> mapping, the participant writes data to the <code class="language-plaintext highlighter-rouge">provide</code> mesh. In principle, each <code class="language-plaintext highlighter-rouge">read</code> mapping can be transformed into a <code class="language-plaintext highlighter-rouge">write</code> mapping (see the section <a href="configuration-mapping.html#restrictions-for-parallel-participants">restrictions for parallel participants</a> below) by shifting the mapping tag on the ‘other’ involved participant (e.g. <code class="language-plaintext highlighter-rouge">MySolver2</code>). Depending on the configuration, data mapping might be computationally demanding. In preCICE the mapping is executed on the participant, where the mapping tag is defined in the configuration file.</p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
All data mappings are executed during <code class="language-plaintext highlighter-rouge">advance</code> and not in <code class="language-plaintext highlighter-rouge">readData</code>, cf. the section on  <a href="couple-your-code-overview.html">how to couple your own code</a>.
</div>

<p>Each mapping defines a <code class="language-plaintext highlighter-rouge">constraint</code>, which defines how the data is mapped between the meshes:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">conservative</code> constraint: <code class="language-plaintext highlighter-rouge">conservative</code> mappings ensure that the global sum of data at the input and output mesh are the same. As an example, one could consider a nearest-neighbor mapping from a fine to a coarse grid: the value at a coarse node is computed as an aggregation of the corresponding fine nodes, such that the total coupling value (in our example <code class="language-plaintext highlighter-rouge">Forces</code>) on the coarse and fine mesh is the same. This is required for quantities that are physically conservative (extensive quantities, such as force, mass, etc.). Visually, the conservative nearest-neighbor example would like like the following:</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     f=2    f=1    f=2    f=1    f=1
------+------+------+------+------+------
          \  |  /          |  /
-------------+-------------+-------------
         f=(2+1+2)     f=(1+1)
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">consistent</code> constraint: <code class="language-plaintext highlighter-rouge">consistent</code> constraints interpolate data between the input and output mesh. This constraint typically applies to intensive quantities such as <code class="language-plaintext highlighter-rouge">Temperature</code> (as in our example configuration) or pressure. Considering once more an example of a mapping from a fine to a coarse mesh using a nearest-neighbor mapping: the value at the coarse node would be the same as the value at the corresponding nearest fine node. Visually, the corresponding nearest-neighbor example could look like this:</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     T=2    T=1    T=2    T=1    T=1
------+------+------+------+------+------
             |             |
-------------+-------------+-------------
            T=1           T=1
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">scaled-consistent-surface</code> and <code class="language-plaintext highlighter-rouge">scaled-consistent-volume</code> constraint: <code class="language-plaintext highlighter-rouge">scaled-consistent</code> constraints are used for intensive quantities (just as the <code class="language-plaintext highlighter-rouge">consistent</code> constraint) where conservation of integral values (surface or volume) is necessary (e.g. velocities when the mass flow rate needs to be conserved). The mapping executes a <code class="language-plaintext highlighter-rouge">consistent</code> mapping in a first step, and corrects the result by a subsequent scaling step using the integral data sum to ensure the conservation of the integral sum on the input mesh and the output mesh. To use the <code class="language-plaintext highlighter-rouge">scaled-consistent-surface</code> constraint, surface connectivity on input and output meshes is required. To use the <code class="language-plaintext highlighter-rouge">scaled-consistent-volume</code> constraint, volumetric connectivity on input and output meshes is required.</li>
</ul>

<p>For a sequential participant, any combination of <code class="language-plaintext highlighter-rouge">read</code>/<code class="language-plaintext highlighter-rouge">write</code>-<code class="language-plaintext highlighter-rouge">consistent/conservative</code> is valid. For a participant running in parallel, only <code class="language-plaintext highlighter-rouge">read</code>-<code class="language-plaintext highlighter-rouge">consistent</code> and <code class="language-plaintext highlighter-rouge">write</code>-<code class="language-plaintext highlighter-rouge">conservative</code> is possible. More details are given <a href="configuration-mapping.html#restrictions-for-parallel-participants">further below</a>.</p>

<h2 id="available-mapping-methods-in-precice">Available mapping methods in preCICE</h2>

<p>The mapping method itself is defined in the xml configuration after the colon <code class="language-plaintext highlighter-rouge">mapping:...</code> (e.g. <code class="language-plaintext highlighter-rouge">&lt;mapping:nearest-neighbor ...</code>). In general, preCICE offers two broader groups of mapping methods</p>

<p><img src="images/docs/configuration/doc-mapping-options.svg" alt="Mapping options" /></p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
Chapter 3.2 (Data mapping) of the preCICE version 2 <a href="https://doi.org/10.12688/openreseurope.14445.2">reference paper</a> explains and compares a selection of projection-based methods and kernel methods.
</div>

<h3 id="projection-based-methods">Projection-based methods</h3>

<p>Projection-based data mapping methods are typically cheap to compute as they don’t involve solving expensive linear systems as opposed to the kernel methods. The basic variant, which operates solely on vertex data, is <code class="language-plaintext highlighter-rouge">nearest-neighbor</code> mapping. All other variants require additional information from the user, as shown in the overview figure above.</p>

<p><img src="images/docs/configuration-mapping-variants.png" alt="different mapping variants visualized" /></p>

<p>Available methods are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">nearest-neighbor</code>: A first-order method, which is fast, easy to use, but, of course, has numerical deficiencies.</li>
  <li><code class="language-plaintext highlighter-rouge">nearest-projection</code>: A (depending on how well the geometries match at the coupling interface) second-order method, which first projects onto surface mesh elements (first-order step) and, then, uses linear interpolation within each element (second-order step) as illustrated in the figure above. The method is still relatively fast and numerically clearly superior to <code class="language-plaintext highlighter-rouge">nearest-neighbor</code>. The downside is that mesh connectivity information needs to be defined, i.e. in the adapter, the participant needs to tell preCICE about edges in 2D and edges, triangles, or quadrilaterals in 3D. On the <a href="couple-your-code-defining-mesh-connectivity.html">mesh connectivity page</a>, we explain how to define connectivity. If no connectivity information is provided, <code class="language-plaintext highlighter-rouge">nearest-projection</code> falls back to a <code class="language-plaintext highlighter-rouge">nearest-neighbor</code> mapping.</li>
  <li><code class="language-plaintext highlighter-rouge">linear-cell-interpolation</code>: Instead of mapping to surface-elements as the <code class="language-plaintext highlighter-rouge">nearest-projection</code>, <code class="language-plaintext highlighter-rouge">linear-cell-interpolation</code> uses volumetric elements, i.e., it is designed for volumetric coupling, where the coupling mesh is a region of space and not a domain boundary. It interpolates on triangles in 2D and on tetrahedra in 3D. Hence, connectivity information for volumetric elements needs to be defined. If none are found, it falls back on <code class="language-plaintext highlighter-rouge">nearest-projection</code> or <code class="language-plaintext highlighter-rouge">nearest-neighbor</code> (depending on the available connectivity information). The method was developed in the <a href="https://mediatum.ub.tum.de/doc/1685618/1685618.pdf">Master’s thesis of Boris Martin</a>, where more detailed information is available.</li>
  <li><code class="language-plaintext highlighter-rouge">nearest-neighbor-gradient</code>: A second-order method, which uses the same algorithm as nearest-neighbor with an additional linear approximation using gradient data. This method requires additional gradient data information. On the <a href="couple-your-code-gradient-data.html">gradient data page</a>, we explain how to add gradient data to the mesh. This method is only applicable with the <code class="language-plaintext highlighter-rouge">consistent</code> constraint. The method was developed <a href="http://dx.doi.org/10.18419/opus-12128">Master’s thesis of Boshra Ariguib</a>, where more detailed information is available.</li>
</ul>

<h3 id="kernel-methods">Kernel methods</h3>

<p>Kernel methods are typically more accurate and can deliver higher-order convergence rates, but are computationally more demanding compared to projection-based mapping methods. All kernel methods operate solely on vertex data such that no additional connectivity information is required from the user. Since preCICE version 3, there are two types of kernel methods available:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">rbf-global-...</code> mapping methods: this method assembles and computes a global (potentially sparse) linear-system on one mesh, which is then evaluated at the other mesh. The global interpolant is formed by a linear combination of radially-symmetric basis-functions centered on each vertex, enriched by a linear polynomial. For <code class="language-plaintext highlighter-rouge">consistent</code> constraints, the resulting linear system has the size <code class="language-plaintext highlighter-rouge">N x N</code>, where <code class="language-plaintext highlighter-rouge">N</code> corresponds to the number of vertices of the <code class="language-plaintext highlighter-rouge">from</code> mesh. For <code class="language-plaintext highlighter-rouge">conservative</code> constraints, the resulting linear system has the size <code class="language-plaintext highlighter-rouge">N x N</code>, where <code class="language-plaintext highlighter-rouge">N</code> corresponds to the number of vertices of the <code class="language-plaintext highlighter-rouge">to</code> mesh. preCICE offers two solution strategies to solve the linear system:</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">rbf-global-direct</code>, which computes initially a dense matrix decomposition of the linear system and applies the matrix decomposition afterwards in every coupling iteration to solve the mapping problem. All involved linear-algebra data structures are dense, regardless of the basis-function configuration. This method can use different <a href="configuration-mapping.html#execution-backends">execution backends</a>. By default, the linear-algebra library Eigen is used. Eigen uses a Cholesky decomposition, if the configured basis-function is strictly positive definite, and a QR decomposition, if that’s not the case. This means that using the mapping with one of the basis-functions <code class="language-plaintext highlighter-rouge">volume-splines</code>, <code class="language-plaintext highlighter-rouge">thin-plate-splines</code> or <code class="language-plaintext highlighter-rouge">multiquadrics</code> takes considerable more time to compute, as these basis-functions are not positive definite. While this mapping method can be used while running a participant in parallel via mpi, a gather-scatter approach is used in preCICE, such that the actual system is solved in serial.</li>
      <li><code class="language-plaintext highlighter-rouge">rbf-global-iterative</code>, which assembles the system matrix initially and solves the resulting system iteratively in each coupling iteration. This method can use different <a href="configuration-mapping.html#execution-backends">execution backends</a>. However, the CPU version relies on the linear-algebra library PETSc, which is an optional dependency of preCICE. The PETSc implementation is fully mpi-parallel and uses sparse linear algebra to solve the resulting system. As a consequence, we need to take care when configuring the basis-function for the mapping: it should only be used with compactly supported basis-functions and the configured support-radius or shape-parameter should only cover a limited number of vertices in radial direction (e.g. 10 vertices) such that the resulting linear system is sparse. Details about this implementation can be found in <a href="https://elib.uni-stuttgart.de/bitstream/11682/10598/3/Lindner%20-%20Data%20Transfer%20in%20Partitioned%20Multi-Physics%20Simulations.pdf">Florian’s thesis (pages 37 ff.)</a>.</li>
    </ul>
  </li>
</ul>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
For global rbf methods, the interpolation problem (or rather the polynomial QR system) might not be well-defined if you map along an axis-symmetric surface. This means, preCICE tries to compute, for example, a 3D interpolant out of 2D information. If so, preCICE throws an error. In this case, you can restrict the interpolation problem by ignoring certain coordinates, e.g. <code class="language-plaintext highlighter-rouge">x-dead="true"</code> to ignore the x coordinate.
</div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">rbf-pum-direct</code>, which breaks down the mapping problem in smaller clusters, solves these clusters locally and blends them afterwards together to recover a global solution. This mapping version only needs the linear-algebra library Eigen and the used linear solver is a dense solver in each cluster (actually the same as for <code class="language-plaintext highlighter-rouge">rbf-global-direct</code>, i.e., it is beneficial to configure strictly positive definite basis-functions). The mapping is specifically designed for large mapping problems and runs fully mpi-parallel. To configure the accuracy of the mapping, the number of <code class="language-plaintext highlighter-rouge">vertices-per-cluster</code> can be increased. The method can only handle sufficiently matching geometries and problems might occur if large gaps exist between the coupling meshes. Further information, including some performance comparisons, can be found in <a href="https://youtu.be/df-JMl7UxRg?si=18X3LFTIepmrtAMc">David’s talk at the preCICE workshop 2023</a>. In practical applications, the partition of unity method typically outperforms any of the global rbf variants.</li>
</ul>

<h4 id="configuration">Configuration</h4>

<p>Configuring kernel methods is more involved and offers more options. A full reference of all options can be found in the <a href="configuration-xml-reference.html">xml reference</a>. On a broader level, the configuration consists of two main options: the applied kernel mapping method and the used basis-function including its support radius or shape parameter. As the decision about the used kernel mapping method can be intricate, we provide an alias called <code class="language-plaintext highlighter-rouge">&lt;mapping:rbf ...</code> which decides dynamically for a kernel method according to the setup (e.g. parallel execution, problem size, available dependencies)</p>

<p><img src="images/docs/configuration/doc-mapping-rbf-alias.svg" alt="RBF alias options" /></p>

<p>An RBF mapping configuration could look as follows</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mapping:rbf</span> <span class="na">direction=</span><span class="s">"read"</span> <span class="na">from=</span><span class="s">"MyMesh2"</span> <span class="na">to=</span><span class="s">"MyMesh1"</span> <span class="na">constraint=</span><span class="s">"consistent"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;basis-function:compact-polynomial-c6</span> <span class="na">support-radius=</span><span class="s">"1.8"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/mapping:rbf&gt;</span>
</code></pre></div></div>

<p>The basis-function has to be defined as a subtag in all kernel methods. In this example the basis-function <code class="language-plaintext highlighter-rouge">compact-polynomial-c6</code> is used with a support radius of <code class="language-plaintext highlighter-rouge">r=1.8</code>.</p>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> 
We recommend to use the alias tag, as long as there are no further requirements regarding the desired mapping method. preCICE reports initially, which mapping method was selected for the alias tag. However, the decision might vary between different versions. If you want to ensure that a specific method is used, use the corresponding mapping tag.
</div>

<p>The configuration of the basis-function is problem-dependent. In general, preCICE offers basis function with global and local support:</p>

<ul>
  <li>Basis-functions with global support (such as <code class="language-plaintext highlighter-rouge">thin-plate-splines</code>) are easier to configure as no further parameter needs to be set. However, typically it pays off in terms of accuracy to configure a basis-function according to your problem dimensions and shape.</li>
  <li>Basis functions with local support need either the definition of a <code class="language-plaintext highlighter-rouge">support-radius</code> (such as for <code class="language-plaintext highlighter-rouge">compact-polynomial-c2</code>) or a <code class="language-plaintext highlighter-rouge">shape-parameter</code> (such as for <code class="language-plaintext highlighter-rouge">gaussian</code>). Selecting a larger and larger support radius leads to a more and more flat basis-function and -in theory- to more and more accurate results. However, the resulting linear system becomes more and more ill-conditioned such that the linear solver might fail eventually.</li>
</ul>

<p>ASTE and our <a href="tutorials-aste-turbine.html">ASTE tutorial</a> enable full insight into the accuracy of the configured mapping method.</p>

<h4 id="execution-backends">Execution backends</h4>

<div class="alert alert-warning" role="alert"><i class="fas fa-flask"></i> <b>Experimental:</b> 
Although this feature is well-tested in preCICE, it relies on an unreleased version of Ginkgo. Hence, this feature might change in the future.
</div>

<p>Starting from version 3, preCICE offers to execute <code class="language-plaintext highlighter-rouge">mapping:rbf-global...</code> on different executor backends using the linear-operator library Ginkgo</p>

<p><img src="images/docs/configuration/doc-mapping-rbf-executors.svg" alt="RBF executors" /></p>

<p>To configure the executor, an additional subtag can be used in the mapping configuration:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mapping:rbf</span> <span class="na">direction=</span><span class="s">"read"</span> <span class="na">from=</span><span class="s">"MyMesh2"</span> <span class="na">to=</span><span class="s">"MyMesh1"</span> <span class="na">constraint=</span><span class="s">"consistent"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;basis-function:compact-polynomial-c6</span> <span class="na">support-radius=</span><span class="s">"1.8"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;executor:cuda</span> <span class="na">gpu-device-id=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/mapping:rbf&gt;</span>
</code></pre></div></div>

<p>More details on the feature can be found in <a href="https://doi.org/10.23967/c.coupled.2023.016">Schneider et al. 2023</a>.</p>

<h2 id="geometric-multiscale-mapping">Geometric multiscale mapping</h2>

<p>Geometric multiscale mapping enables the coupling of dimensionally heterogeneous coupling participants, e.g., a 1D system code with a 3D CFD code.</p>

<div class="alert alert-warning" role="alert"><i class="fas fa-flask"></i> <b>Experimental:</b> 
This is an experimental feature, available since preCICE v3.0.0. Enable it using <code class="language-plaintext highlighter-rouge">&lt;precice-configuration experimental="true"&gt;</code> and do not consider the configuration to be stable yet. For now, since preCICE does not yet support 1D meshes, both input and output meshes are defined as 3D, and a primary axis defines the active component of the 1D data. Are you interested in this feature? Give us your feedback!
</div>

<p>We differentiate between <em>axial</em> and <em>radial</em> geometric multiscale mapping:</p>

<table>
  <tbody>
    <tr>
      <td><img src="images/docs/configuration-mapping-geometric-multiscale-axial-1d-3d.png" alt="Axial geometric multiscale mapping" width="500" /></td>
      <td><img src="images/docs/configuration-mapping-geometric-multiscale-radial-1d-3d.png" alt="Radial geometric multiscale mapping" width="500" /></td>
    </tr>
    <tr>
      <td>Axial 1D-3D consistent-spread mapping</td>
      <td>Radial 1D-3D consisntent-spread mapping</td>
    </tr>
  </tbody>
</table>

<p>In a 1D-3D mapping, axial mapping maps between one point at the boundary of the 1D domain and multiple points at a surface of a 3D domain, while the domains are connected over a main axis.
Radial mapping maps between multiple (internal) points of the 1D domain and multiple points at a surface of a 3D domain. In a 1D-3D domain, the 3D domain can encapsulate the 1D domain, or the 1D domain can be a line on the surface of the 3D domain.
Currently, axial and radial geometric multiscale coupling is only supported in a consistent manner between 1D and 3D participants and over a circular interface, but extensions to this are planned.</p>

<p>The concept also extends to 1D-2D, 2D-3D, and further setups, which are not currently supported.</p>

<p>Potential configurations for the axial and radial geometric multiscale mapping look as follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mapping:axial-geometric-multiscale</span> <span class="na">direction=</span><span class="s">"read"</span> <span class="na">type=</span><span class="s">"spread"</span> <span class="na">radius=</span><span class="s">"1.0"</span> <span class="na">axis=</span><span class="s">"X"</span> <span class="na">from=</span><span class="s">"MyMesh2"</span> <span class="na">to=</span><span class="s">"MyMesh1"</span> <span class="na">constraint=</span><span class="s">"consistent"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;mapping:radial-geometric-multiscale</span> <span class="na">direction=</span><span class="s">"read"</span> <span class="na">type=</span><span class="s">"collect"</span> <span class="na">axis=</span><span class="s">"X"</span> <span class="na">from=</span><span class="s">"MyMesh1"</span> <span class="na">to=</span><span class="s">"MyMesh2"</span> <span class="na">constraint=</span><span class="s">"consistent"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">type</code> which can be either <code class="language-plaintext highlighter-rouge">"spread"</code> or <code class="language-plaintext highlighter-rouge">"collect"</code> refers to whether the participant spreads data from one mesh node to multiple nodes or collects data from multiple mesh nodes into one node. The <code class="language-plaintext highlighter-rouge">axis</code> is the main axis, along which the coupling takes place, i.e. the principal axis of the 1D and 3D participants. The <code class="language-plaintext highlighter-rouge">radius</code> refers to the radius of the circular interface boundary surface.</p>

<p>Since the 1D participant likely computes average quantities, e.g., the average pressure and velocity in a pipe, a velocity profile has to be assumed in order to convert data between the 1D and 3D participant for the axial mapping. Currently, a laminar flow profile is imposed by default, but different profiles might be supported in the future.</p>

<h2 id="restrictions-for-parallel-participants">Restrictions for parallel participants</h2>

<p>As stated above, for parallel participants only <code class="language-plaintext highlighter-rouge">read</code>-<code class="language-plaintext highlighter-rouge">consistent</code> and <code class="language-plaintext highlighter-rouge">write</code>-<code class="language-plaintext highlighter-rouge">conservative</code> are valid combinations. If want to find out why, have a look at <a href="https://mediatum.ub.tum.de/doc/1320661/document.pdf">Benjamin’s thesis</a>, page 85. But what to do if you want a <code class="language-plaintext highlighter-rouge">write</code>-<code class="language-plaintext highlighter-rouge">consistent</code> mapping? The trick is to move the mapping to the other participant, then <code class="language-plaintext highlighter-rouge">write</code> becomes <code class="language-plaintext highlighter-rouge">read</code>:</p>

<ul>
  <li>Move the mapping, adjust <code class="language-plaintext highlighter-rouge">write</code> to <code class="language-plaintext highlighter-rouge">read</code></li>
  <li>Be sure that the other participant also uses both meshes. Probably you need an additional <code class="language-plaintext highlighter-rouge">&lt;receive-mesh name="MyMesh1" from="MySolver1"/&gt;</code>. This means another mesh is communicated at initialization, which can increase initialization time.</li>
  <li>Last, be sure to update the <code class="language-plaintext highlighter-rouge">exchange</code> tags in the coupling scheme, compare the <a href="configuration-coupling.html">coupling scheme configuration</a> (e.g. change which mesh is used for the exchange and acceleration)</li>
</ul>

<div class="alert alert-success" role="alert"><i class="fa fa-check-square"></i> <b>Tip:</b> 
After applying these changes, you can use the <a href="https://github.com/precice/config-visualizer">preCICE Config Visualizer</a> to visually validate your updated configuration file.
</div>

<p>Maybe an example helps. You find one <a href="https://precice.discourse.group/t/data-mapping-not-allowed-for-parallel-computation/374">in the preCICE Forum</a>.</p>


    <div class="tags">
        
    </div>



</div>


                        <hr class="faded"/>
                        <footer>
	<div class="row text-center">

		 Site last generated: Feb 12, 2024 <br />

		<a class="no-icon" rel="license" href="https://creativecommons.org/licenses/by/4.0/">
			<img alt="Creative Commons License" src="images/licensebutton-by-40_88x31.png" />
		</a>
		<br />
		This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.

	</div>

</footer>

                    </div>
                    <!-- /.row -->
                </div>
            <!-- /.container -->
            </div>
        <!-- /#main -->
        </div>
    </main>
</body>


</html>
